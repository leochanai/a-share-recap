---
import type { CollectionEntry } from 'astro:content';

interface MarketOverview {
  indices: { name: string; close: string; change: string }[];
  volume: string;
}

interface Props {
  report: CollectionEntry<'reports'>;
  overview?: MarketOverview;
}

const { report, overview } = Astro.props;

const dateObj = new Date(report.data.date);
const weekday = dateObj.toLocaleDateString('zh-CN', { weekday: 'short' });
const day = dateObj.getDate();
const month = dateObj.toLocaleDateString('zh-CN', { month: 'short' });
const year = dateObj.getFullYear();

// 判断涨跌颜色
function getChangeColor(change: string) {
  if (change.includes('+')) return 'var(--color-up, #ef4444)';
  if (change.includes('-')) return 'var(--color-down, #22c55e)';
  return 'var(--color-text-secondary)';
}
---

<a href={`/reports/${report.slug}`} class="report-card group block h-full">
  <article class="h-full p-6 rounded-lg border transition-all duration-300"
    style="background-color: var(--color-bg-secondary); border-color: var(--color-border);">

    <!-- Header: Date & Title -->
    <div class="flex items-start justify-between mb-4">
      <div class="flex items-center gap-4">
        <!-- Date Block -->
        <div class="text-center">
          <div class="font-display text-3xl font-semibold leading-none" style="color: var(--color-accent);">
            {day}
          </div>
          <div class="font-mono text-xs mt-1" style="color: var(--color-text-muted);">
            {month}
          </div>
        </div>

        <div>
          <div class="font-mono text-xs uppercase tracking-widest mb-1" style="color: var(--color-text-muted);">
            {weekday} · {year}
          </div>
          <h2 class="text-lg font-semibold group-hover:text-[var(--color-accent)] transition-colors" style="color: var(--color-text-primary);">
            A股市场复盘
          </h2>
        </div>
      </div>

      <!-- Arrow -->
      <div class="flex-shrink-0 opacity-0 group-hover:opacity-100 transform translate-x-0 group-hover:translate-x-1 transition-all duration-300">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: var(--color-accent);">
          <path d="M5 12h14M12 5l7 7-7 7"/>
        </svg>
      </div>
    </div>

    <!-- Market Overview -->
    {overview && overview.indices.length > 0 && (
      <div class="mb-4">
        <div class="grid grid-cols-2 gap-3">
          {overview.indices.slice(0, 4).map((idx) => (
            <div class="p-3 rounded" style="background-color: var(--color-bg-tertiary);">
              <div class="font-mono text-xs mb-1" style="color: var(--color-text-muted);">
                {idx.name}
              </div>
              <div class="flex items-baseline gap-2">
                <span class="font-mono text-sm font-medium" style="color: var(--color-text-primary);">
                  {idx.close}
                </span>
                <span class="font-mono text-xs font-medium" style={`color: ${getChangeColor(idx.change)};`}>
                  {idx.change}
                </span>
              </div>
            </div>
          ))}
        </div>

        {overview.volume && (
          <div class="mt-3 flex items-center gap-2 font-mono text-xs" style="color: var(--color-text-muted);">
            <span>成交额</span>
            <span style="color: var(--color-text-secondary);">{overview.volume}</span>
          </div>
        )}
      </div>
    )}

    <!-- Tags -->
    <div class="flex flex-wrap gap-2">
      {report.data.tags.map((tag) => (
        <span class="inline-block font-mono text-xs px-2 py-0.5 rounded-sm"
          style="background-color: var(--color-bg-tertiary); color: var(--color-text-secondary);">
          {tag}
        </span>
      ))}
    </div>
  </article>
</a>

<style>
  .report-card:hover article {
    border-color: var(--color-accent) !important;
    background-color: var(--color-bg-tertiary) !important;
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
  }
</style>
